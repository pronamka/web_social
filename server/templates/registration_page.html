<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PronamkaScience</title>
    <link rel='stylesheet' type="text/css" href="{{ url_for('static',  filename='css/n.css') }}">
    <meta name="viewport" content="width=device-width">
</head>
<body>
<div class="wrapper_weblogins">
    <div class="container">
        <div id="app_info">
            <img src="{{ url_for('static',  filename='images/pronamka.ico') }}" id="app_logo">
            <h3 style="display: inline-block;">PronamkaScience</h3>
        </div>
        <div id="inputs">
            <h2>Create an account</h2>
            <i class="fa-solid fa-user"></i>
            <input name="login" placeholder="login" type="text" class="info" id="login"><br>
            <i class="fa-solid fa-lock"></i>
            <input name="password" placeholder="password" type="password" class="info" id="password"><br>
            <i class="fa-solid fa-envelope-open"></i>
            <input name="email" placeholder="email" type="email" class="info" id="email"><br>
            <button onclick="sendData();" id="create_account_button">Submit</button>
            <p id="validation_errors">{{errors}}</p>
            <p>Already have an account? <a href="/log_in_page">Log in</a></p>
        </div>
        
    </div>
</div>
<script>
    function sendRequest(method, url, body, multipart=false) {
        const headers = {'Content-Type': 'application/json'}
            return fetch(url, {
                method: method,
                body: JSON.stringify(body),
                headers: headers}).then(response => {
                return response.text();
        })
    }
    function sendData(){
        const login = document.getElementById('login').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if (login == '' | email == '' | password == ''){
            document.getElementById('validation_errors').innerHTML='Please, fill in all the fields.';
            return false;
        }
        else{
            sendRequest('POST', '/register/', 
            {'login': login, 'password': password, 'email': email}).then(resp =>{
                const response = JSON.parse(resp)
                const status = response['status']
                if (status == 406){
                    document.getElementById('validation_errors').innerHTML=response['error'];
                }
                else if (status == 300) {
                    alert('We have sent a confirmation email to you. Please, check it.');
                    window.location.replace(response['redirect'])
                }
            })
        }
    }
</script>

</body>
</html>